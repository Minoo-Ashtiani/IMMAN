# library(installr)
# updateR()

source("http://bioconductor.org/biocLite.R")
biocLite("BiocUpgrade")

source("http://www.bioconductor.org/biocLite.R")
biocLite("BiocFileCache", dependencies = TRUE)

library(BiocFileCache)

path <- file.path(tempdir(), "tempCacheDir")
bfc <- BiocFileCache(path)

# show the cache path
bfccache(bfc)

# show the number of files currently being tracked by the BiocFileCache
length(bfc)

# For more detailed information on what is store in the BiocFileCache object, there is a show method which will display the object, 
# object class, cache path, and number of items currently being tracked.
show(bfc)

# list a table of BiocFileCache resource files being tracked in the cache. It returns a dplyr object of class tbl_sqlite.
bfcinfo(bfc)

# The table of resource files includes the following information:
# rid: resource id. Autogenerated. This is a unique identifier automatically generated when a resource is added to the cache.
# rname: resource name. This is given by the user when a resource is added to the cache. It does not have to be unique and can 
# be updated at anytime. We recommend descriptive key words and identifiers.
# create_time: The date and time a resource is added to the cache.
# access_time: The date and time a resource is utilized within the cache. The access time is updated when the resource is updated or accessed.
# rpath: resource path. This is the path to the local file.
# rtype: resource type. Either "local" or "web", indicating if the resource has a remote origin.
# fpath: If rtype is "web", this is the link to the remote resource. It will be utilized to download the remote data.
# last_modified_time: For a remote resource, the last_modified (if available) information for the local copy of the data. This information is checked against the remote resource to determine if the local copy is stale and needs to be updated.

# two functions to add a resource to the cache:
bfcnew() # creates an entry for a resource and returns a filepath to save to. As there are many types of data that can be saved 
# in many different ways, bfcnew() allows you to save any R data object in the appropriate manner and 
# still be able to track the saved file. 
bfcadd() # should be utilized when a file already exists or a remote resource is being accessed.


savepath <- bfcnew(bfc, "NewResource", ext="RData")
savepath

m = matrix(1:12, nrow=3)
save(m, file=savepath)

## and that file will be tracked in the cache
bfcinfo(bfc)

Something along the following would save:

#########################################################################################

myList = list()

bfc = BiocFileCache()

path = bfcnew(bfc, "STRING_DB Downloaded Files")
              
save(myList, file=path)

# For retrieval in next session:

# get the rid of the list
bfcquery(bfc, c("STRING_DB Downloaded Files")
              
# then choose what rid you want to load from the cache and use that to retrieve path - in this case BFC12:
              
path = bfcpath(bfc, "BFC12")
load(path)
              
              